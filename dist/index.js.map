{"version":3,"sources":["../src/index.js"],"names":["PORT","app","server","http","createServer","use","exposedHeaders","bodyParser","json","limit","WebSocket","require","ws","Server","clients","on","socket","userId","length","newClient","push","console","log","message","filter","client","get","req","res","version","next","people","setInterval","forEach","msg","send","listen","process","env","address","port"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;AAEA,IAAMA,OAAO,IAAb;AACA,IAAMC,MAAM,wBAAZ;AACAA,IAAIC,MAAJ,GAAaC,eAAKC,YAAL,CAAkBH,GAAlB,CAAb;;AAGAA,IAAII,GAAJ,CAAQ,sBAAO,KAAP,CAAR;;AAGAJ,IAAII,GAAJ,CAAQ,oBAAK;AACTC,oBAAgB;AADP,CAAL,CAAR;;AAIAL,IAAII,GAAJ,CAAQE,qBAAWC,IAAX,CAAgB;AACpBC,WAAO;AADa,CAAhB,CAAR;;AAMA,IAAMC,YAAYC,QAAQ,IAAR,CAAlB;;AAEAV,IAAIW,EAAJ,GAAS,IAAIF,UAAUG,MAAd,CAAqB;AAC1BX,YAAQD,IAAIC;AADc,CAArB,CAAT;;AAIA,IAAIY,UAAU,EAAd;;AAEAb,IAAIW,EAAJ,CAAOG,EAAP,CAAU,YAAV,EAAwB,UAACC,MAAD,EAAY;;AAEhC,QAAMC,SAASH,QAAQI,MAAR,GAAiB,CAAhC;;AAEAF,WAAOC,MAAP,GAAgBA,MAAhB;;AAEA,QAAME,YAAY;AACdP,YAAII,MADU;AAEdC,gBAAQA;AAFM,KAAlB;;AAKAH,YAAQM,IAAR,CAAaD,SAAb;AACAE,YAAQC,GAAR,CAAY,sBAAZ,EAAoCL,MAApC;AACA;AACAD,WAAOD,EAAP,CAAU,SAAV,EAAqB,UAACQ,OAAD,EAAa;AAC9B;AACAF,gBAAQC,GAAR,CAAY,cAAZ,EAA4BC,OAA5B;AACH,KAHD;;AAKAP,WAAOD,EAAP,CAAU,OAAV,EAAmB,YAAM;AACrBM,gBAAQC,GAAR,CAAY,oBAAZ,EAAkCL,MAAlC,EAA0C,iBAA1C;;AAEAH,kBAAUA,QAAQU,MAAR,CAAe,UAACC,MAAD;AAAA,mBAAYA,OAAOR,MAAP,KAAkBA,MAA9B;AAAA,SAAf,CAAV;AACH,KAJD;AAKH,CAxBD;;AA0BAhB,IAAIyB,GAAJ,CAAQ,GAAR,EAAa,UAACC,GAAD,EAAMC,GAAN,EAAc;AACvBA,QAAIpB,IAAJ,CAAU;AACNqB,iBAASA;AADH,KAAV;AAGH,CAJD;;AAMA5B,IAAIyB,GAAJ,CAAQ,sBAAR,EAAgC,UAACC,GAAD,EAAMC,GAAN,EAAWE,IAAX,EAAoB;AAChD,WAAOF,IAAIpB,IAAJ,CAAS;AACZuB,gBAAQjB;AADI,KAAT,CAAP;AAGH,CAJD;;AAMAkB,YAAY,YAAM;AACd;AACAX,YAAQC,GAAR,CAAY,WAAZ,EAAyBR,QAAQI,MAAjC,EAAyC,uBAAzC;AACA,QAAGJ,QAAQI,MAAR,GAAiB,CAApB,EAAuB;AACnBJ,gBAAQmB,OAAR,CAAgB,UAACR,MAAD,EAAY;AACxB,gBAAMS,kBAAgBT,OAAOR,MAAvB,mCAAN;AACAQ,mBAAOb,EAAP,CAAUuB,IAAV,CAAeD,GAAf;AACH,SAHD;AAIH;AACJ,CATD,EASG,IATH;;AAWAjC,IAAIC,MAAJ,CAAWkC,MAAX,CAAkBC,QAAQC,GAAR,CAAYtC,IAAZ,IAAoBA,IAAtC,EAA4C,YAAM;AAC1CqB,YAAQC,GAAR,6BAAsCrB,IAAIC,MAAJ,CAAWqC,OAAX,GAAqBC,IAA3D;AACP,CAFD;;kBAIevC,G","file":"index.js","sourcesContent":["import http from 'http';\r\nimport express from 'express';\r\nimport cors from 'cors';\r\nimport morgan from 'morgan';\r\nimport bodyParser from 'body-parser';\r\nimport {version} from '../package.json';\r\nimport { createConnection } from 'net';\r\n\r\nconst PORT = 3000;\r\nconst app = express();\r\napp.server = http.createServer(app);\r\n\r\n\r\napp.use(morgan('dev'));\r\n\r\n\r\napp.use(cors({\r\n    exposedHeaders: \"*\"\r\n}));\r\n\r\napp.use(bodyParser.json({\r\n    limit: '50mb'\r\n}));\r\n\r\n\r\n\r\nconst WebSocket = require('ws');\r\n\r\napp.ws = new WebSocket.Server({\r\n    server: app.server\r\n});\r\n\r\nlet clients = [];\r\n\r\napp.ws.on('connection', (socket) => {\r\n\r\n    const userId = clients.length + 1;\r\n\r\n    socket.userId = userId;\r\n    \r\n    const newClient = {\r\n        ws: socket,\r\n        userId: userId,\r\n    };\r\n\r\n    clients.push(newClient);\r\n    console.log('New Client connected', userId);\r\n    // listen to client\r\n    socket.on('message', (message) => {\r\n        // socket.send(message +\"\"+ new Date());\r\n        console.log('Message from', message);\r\n    });\r\n\r\n    socket.on('close', () => {\r\n        console.log('Client with userId', userId, 'is disconnected');\r\n\r\n        clients = clients.filter((client) => client.userId !== userId);\r\n    });\r\n});\r\n\r\napp.get('/', (req, res) => {\r\n    res.json ({\r\n        version: version \r\n    }) \r\n});\r\n\r\napp.get('/api/all_connections', (req, res, next) => {\r\n    return res.json({\r\n        people: clients,\r\n    })\r\n});\r\n\r\nsetInterval(() => {\r\n    // each 3 sec the function executes\r\n    console.log('There are', clients.length ,'clients in connection');\r\n    if(clients.length > 0) {\r\n        clients.forEach((client) => {\r\n            const msg = `Hey ID ${client.userId} this is a message from Server`;\r\n            client.ws.send(msg);\r\n        });\r\n    }\r\n}, 3000)\r\n\r\napp.server.listen(process.env.PORT || PORT, () => {\r\n        console.log(`App is running on port ${app.server.address().port}`);\r\n});\r\n\r\nexport default app;"]}